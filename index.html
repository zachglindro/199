<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>reveal.js</title>

    <link rel="stylesheet" href="dist/reset.css" />
    <link rel="stylesheet" href="dist/reveal.css" />
    <link rel="stylesheet" href="dist/theme/black.css" />

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" />
    <link rel="stylesheet" href="css/custom.css" />
    <style>
      /* lightweight styles specifically for the CRDTs auto-animate slide */
      .crdts-stack {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
      }
      .crdts-row {
        display: flex;
        gap: 0;
        align-items: center;
        justify-content: center;
      }
      .crdts-letter {
        font-size: 4.5rem;
        line-height: 1;
        font-weight: 700;
        display: inline-block;
      }
      /* Vertical stack used for splitting a long tail into two lines
         Make the combined height of two tails match the single large letter.
         Use relative units so it scales with the letter's font-size. */
      .crdts-vertical {
        display: inline-flex;
        flex-direction: column;
        gap: 0; /* no extra gap; we'll control line-height */
        align-items: flex-start; /* left-align the tails under the letter */
        font-size: 2.25rem; /* half of .crdts-letter (4.5rem) */
        align-self: center;
        vertical-align: middle;
        margin-left: 0.5rem; /* small gap to the right of the letter */
      }
      .crdts-words {
        font-size: 2.25rem;
        line-height: 1.1;
        /* make the whole block shrink-wrap so it can be centered, but left-align its lines */
        display: inline-block;
        text-align: left;
        /* optional: keep block compact on very wide slides */
        max-width: 28rem;
        vertical-align: middle;
      }
      /* Ensure the big letter itself aligns vertically with the middle of the stacked tails */
      .crdts-spec-letter {
        vertical-align: middle;
        font-size: 2.25em;
        font-weight: bold;
      }
      /* ensure the stack container centers the inline-block */
      .crdts-stack {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      /* hide trailing fragments until revealed */
      .crdts-tail {
        display: inline-block;
        opacity: 0;
        transform: translateY(6px);
        transition: opacity 300ms ease, transform 300ms ease;
        will-change: opacity, transform;
        /* each tail line should occupy half the height of the big letter
           (we set .crdts-vertical font-size to 2.25rem, which equals half). */
        line-height: 1; /* 1em each */
        font-size: inherit; /* inherit the 2.25rem from .crdts-vertical */
      }
      /* make the two-line stacked tails slightly smaller for better visual fit */
      .crdts-vertical .crdts-tail {
        font-size: 0.6em; /* slight reduction */
        line-height: 1; /* ensure compact stacking */
      }
      .crdts-tail.visible {
        opacity: 1;
        transform: translateY(0);
      }
      /* Opt-out for specific tails that should not animate (show immediately) */
      .crdts-tail.no-animate {
        opacity: 1 !important;
        transform: none !important;
        transition: none !important;
      }
      /* dim less-important letters/words */
      .crdts-dim {
        color: #9aa0a6; /* gray */
        opacity: 0.45;
        transition: opacity 300ms ease, color 300ms ease, transform 300ms ease;
      }
      /* highlight the Conflict-free letter */
      .crdts-highlight {
        color: #ffd54f; /* warm yellow */
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
        /* don't translate the letter: keep it stable for auto-animate */
        transform: none;
        transition: color 300ms ease;
      }
      /* when a letter is dimmed, dim the trailing fragment as well */
      .crdts-dim + .crdts-tail,
      .crdts-dim ~ .crdts-tail {
        color: #9aa0a6;
        opacity: 0.45;
      }
      /* ensure highlighted tails remain fully visible */
      .crdts-highlight + .crdts-tail,
      .crdts-highlight ~ .crdts-tail {
        opacity: 1;
      }
    </style>
  </head>

  <body>
    <div class="reveal" role="region" aria-label="Presentation slides">
      <div class="slides">
        <!-- Slide 1 -->
        <section>
          <h3>CRDT<span style="text-transform: lowercase">s</span></h3>
          <p>Enabling Collaboration in a Decentralized Systems</p>
          <p>
            <small>Zach Glindro</small>
          </p>
        </section>

        <!-- Slide 2 -->
        <section>
          <section>
            <div class="icons-row" aria-hidden="false">
              <figure class="icon-figure">
                <img src="assets/git.png" alt="git icon" class="slide-icon" />
                <figcaption>git</figcaption>
              </figure>
              <figure class="icon-figure">
                <img
                  src="assets/github.png"
                  alt="github icon"
                  class="slide-icon"
                />
                <figcaption>github</figcaption>
              </figure>
            </div>
          </section>
          <section>
            <div class="console" id="console">
              <pre class="console-output" id="console-output"></pre>
              <div class="console-input">
                $ <span id="console-caret"></span>
              </div>
            </div>
          </section>
        </section>

        <!-- Slide 3-->
        <section>
          <section>
            <div class="center-graphic">
              <svg
                viewBox="0 0 600 360"
                class="network-svg"
                aria-hidden="true"
                role="img"
                aria-label="Network diagram"
              >
                <defs>
                  <filter id="glow">
                    <feGaussianBlur stdDeviation="4" result="coloredBlur" />
                    <feMerge>
                      <feMergeNode in="coloredBlur" />
                      <feMergeNode in="SourceGraphic" />
                    </feMerge>
                  </filter>
                </defs>
                <!-- links (rendered first so they appear behind nodes) -->
                <line
                  class="link offline"
                  data-from="c1"
                  x1="120"
                  y1="80"
                  x2="300"
                  y2="180"
                />
                <line
                  class="link offline"
                  data-from="c2"
                  x1="480"
                  y1="80"
                  x2="300"
                  y2="180"
                />
                <line
                  class="link offline"
                  data-from="c3"
                  x1="300"
                  y1="300"
                  x2="300"
                  y2="180"
                />
                <!-- central server -->
                <g id="server" class="offline" transform="translate(300,180)">
                  <rect
                    x="-36"
                    y="-22"
                    width="72"
                    height="44"
                    rx="6"
                    ry="6"
                    class="server-box"
                  />
                  <text x="0" y="6" text-anchor="middle" class="server-label">
                    Server
                  </text>
                </g>
                <!-- clients -->
                <g
                  class="client offline"
                  data-id="c1"
                  transform="translate(120,80)"
                >
                  <circle r="18" class="client-dot" />
                  <text y="34" text-anchor="middle" class="client-label">
                    A
                  </text>
                </g>
                <g
                  class="client offline"
                  data-id="c2"
                  transform="translate(480,80)"
                >
                  <circle r="18" class="client-dot" />
                  <text y="34" text-anchor="middle" class="client-label">
                    B
                  </text>
                </g>
                <g
                  class="client offline"
                  data-id="c3"
                  transform="translate(300,300)"
                >
                  <circle r="18" class="client-dot" />
                  <text y="34" text-anchor="middle" class="client-label">
                    C
                  </text>
                </g>
              </svg>
            </div>
          </section>
          <section>
            <p class="inline-text">Strong consistency</p>
          </section>
          <section data-auto-animate>
            <div class="icons-row" aria-hidden="false">
              <figure class="icon-figure">
                <img src="assets/docs.svg" alt="docs icon" class="slide-icon" />
                <figcaption data-id="docs-slide3-id">docs</figcaption>
              </figure>
            </div>
          </section>
          <section data-auto-animate>
            <div class="icons-row" aria-hidden="false">
              <figure class="icon-figure">
                <img src="assets/docs.svg" alt="docs icon" class="slide-icon" />
                <figcaption data-id="docs-slide3-id">docs</figcaption>
              </figure>
              <div>
                <p>No offline access</p>
                <p>Loss of data ownership</p>
                <p>Service dependency</p>
              </div>
            </div>
          </section>
        </section>

        <!-- Slide 4: Eventual consistency -->
        <section>
          <section><p>Eventual consistency</p></section>
          <section>
            <!-- Slide 4: Interactive replicas figure -->
            <div class="replicas-figure center-graphic">
              <div class="replicas-row">
                <div class="replica" data-id="A">
                  <div class="replica-header">
                    Replica A
                    <span class="status-badge online" aria-hidden="true"
                      >Online</span
                    >
                  </div>
                  <ul class="replica-list" aria-live="polite">
                    <li>Milk</li>
                  </ul>
                </div>

                <div class="replica" data-id="B">
                  <div class="replica-header">
                    Replica B
                    <span class="status-badge online" aria-hidden="true"
                      >Online</span
                    >
                  </div>
                  <ul class="replica-list" aria-live="polite">
                    <li>Milk</li>
                  </ul>
                </div>

                <div class="replica" data-id="C">
                  <div class="replica-header">
                    Replica C
                    <span class="status-badge online" aria-hidden="true"
                      >Online</span
                    >
                  </div>
                  <ul class="replica-list" aria-live="polite">
                    <li>Milk</li>
                  </ul>
                </div>
              </div>

              <div class="replica-connections" aria-hidden="true">
                <svg
                  class="replica-lines"
                  viewBox="0 0 600 120"
                  preserveAspectRatio="none"
                  role="img"
                  aria-hidden="true"
                >
                  <!-- lines between centers of boxes -->
                  <line
                    id="line-ab"
                    class="line"
                    x1="100"
                    y1="60"
                    x2="300"
                    y2="60"
                    stroke-width="3"
                    stroke-linecap="round"
                  />
                  <line
                    id="line-bc"
                    class="line"
                    x1="300"
                    y1="60"
                    x2="500"
                    y2="60"
                    stroke-width="3"
                    stroke-linecap="round"
                  />
                </svg>
              </div>

              <div class="replica-controls">
                <button id="replica-btn" class="replica-button">
                  <span>&rarr;</span>
                </button>
              </div>
            </div>
          </section>
        </section>

        <!-- Slide 5 -->
        <section>
          <!-- step 1: single word CRDT -->
          <section data-auto-animate>
            <div class="crdts-stack">
              <div class="crdts-row">
                <span class="crdts-letter" data-id="letter-C">C</span>
                <span class="crdts-letter" data-id="letter-R">R</span>
                <span class="crdts-letter" data-id="letter-D">D</span>
                <span class="crdts-letter" data-id="letter-T">T</span>
              </div>
            </div>
          </section>

          <!-- step 2: full words laid out vertically (letters kept as same elements for auto-animate) -->
          <section data-auto-animate>
            <div class="crdts-stack">
              <div class="crdts-words">
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-C">C</span>
                    <span class="crdts-tail">onflict-free</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-R">R</span>
                    <span class="crdts-tail">eplicated</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-D">D</span>
                    <span class="crdts-tail">ata</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-T">T</span>
                    <span class="crdts-tail">ypes</span>
                  </span>
                </div>
              </div>
            </div>
          </section>
          <!-- step 3: dim 'Replicated Data Types' and highlight 'Conflict-free' -->
          <section data-auto-animate>
            <div class="crdts-stack">
              <div class="crdts-words">
                <div>
                  <span>
                    <span
                      class="crdts-letter crdts-highlight"
                      data-id="letter-C"
                      >C</span
                    >
                    <span class="crdts-tail">onflict-free</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter crdts-dim" data-id="letter-R"
                      >R</span
                    >
                    <span class="crdts-tail">eplicated</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter crdts-dim" data-id="letter-D"
                      >D</span
                    >
                    <span class="crdts-tail">ata</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter crdts-dim" data-id="letter-T"
                      >T</span
                    >
                    <span class="crdts-tail">ypes</span>
                  </span>
                </div>
              </div>
            </div>
          </section>
          <section>
            <p>Strong eventual consistency</p>
          </section>
        </section>

        <!-- Slide 6 -->
        <section>
          <!-- Commutative CRDT (copy of slide 5 step 2 with Conflict-free -> Commutative) -->
          <section>
            <div class="crdts-stack">
              <div class="crdts-words">
                <div>
                  <span>
                    <span class="crdts-spec-letter" data-id="letter-C">C</span>
                    <span class="crdts-vertical">
                      <span class="crdts-tail crdts-highlight no-animate"
                        >ommutative</span
                      >
                      <span class="crdts-tail no-animate">onvergent</span>
                    </span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-R">R</span>
                    <span class="crdts-tail no-animate">eplicated</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-D">D</span>
                    <span class="crdts-tail no-animate">ata</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-T">T</span>
                    <span class="crdts-tail no-animate">ypes</span>
                  </span>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- Slide 7-->
        <section>
          <!-- Convergent CRDT (copy of slide 5 step 2 with Conflict-free -> Convergent) -->
          <section>
            <div class="crdts-stack">
              <div class="crdts-words">
                <div>
                  <span>
                    <span class="crdts-spec-letter" data-id="letter-C">C</span>
                    <span class="crdts-vertical">
                      <span class="crdts-tail">ommutative</span>
                      <span class="crdts-tail crdts-highlight">onvergent</span>
                    </span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-R">R</span>
                    <span class="crdts-tail">eplicated</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-D">D</span>
                    <span class="crdts-tail">ata</span>
                  </span>
                </div>
                <div>
                  <span>
                    <span class="crdts-letter" data-id="letter-T">T</span>
                    <span class="crdts-tail">ypes</span>
                  </span>
                </div>
              </div>
            </div>
          </section>
        </section>

        <!-- Slide 8 -->
        <section>Examples</section>

        <!-- Slide 9 -->
        <section>PCGRID</section>

        <!-- Slide 10 -->
        <section>PCGRID</section>

        <!-- Slide 11 -->
        <section>Conclusion</section>

        <!-- Slide 12 -->
        <section>
          <p>Thank you!</p>
          <p>Q & A</p>
        </section>
      </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
      });
      // Delayed reveal for CRDT word fragments on the CRDT slide step
      (function () {
        var crdtTimeout = null;
        var autoAdvanceTimer = null; // timer for advancing from step 1 -> step 2

        function hideTails() {
          var tails = document.querySelectorAll(".crdts-tail");
          tails.forEach(function (el) {
            el.classList.remove("visible");
          });
        }

        function revealTailsDelayed() {
          // Clear any existing timer
          if (crdtTimeout) {
            clearTimeout(crdtTimeout);
            crdtTimeout = null;
          }
          crdtTimeout = setTimeout(function () {
            var tails = document.querySelectorAll(".crdts-tail");
            tails.forEach(function (el) {
              el.classList.add("visible");
            });
            crdtTimeout = null;
          }, 1000);
        }

        function scheduleAutoAdvance() {
          // Advance from the letters-only step to the words step after 1s
          if (autoAdvanceTimer) return; // already scheduled
          autoAdvanceTimer = setTimeout(function () {
            autoAdvanceTimer = null;
            // Move to next vertical step (the words layout)
            Reveal.next();
          }, 1000);
        }

        function cancelAutoAdvance() {
          if (autoAdvanceTimer) {
            clearTimeout(autoAdvanceTimer);
            autoAdvanceTimer = null;
          }
        }

        // On initial ready and when the slide changes, check if we're on the CRDT step
        function onRevealEvent(e) {
          // The step containing .crdts-words will be in the DOM as the current slide
          var current =
            e && e.currentSlide
              ? e.currentSlide
              : document.querySelector(".slides section.present");
          if (!current) return;

          // If we're on the letters-only first step: it has .crdts-row but not .crdts-words
          var isLettersOnly =
            current.querySelector &&
            current.querySelector(".crdts-row") &&
            !current.querySelector(".crdts-words");

          if (current.querySelector && current.querySelector(".crdts-words")) {
            // reveal tails after delay
            revealTailsDelayed();
            // ensure we don't auto-advance when already on the words step
            cancelAutoAdvance();
          } else {
            // hide immediately when leaving words step
            if (crdtTimeout) {
              clearTimeout(crdtTimeout);
              crdtTimeout = null;
            }
            hideTails();
            // If we landed on the letters-only step, schedule auto-advance to next step
            if (isLettersOnly) {
              scheduleAutoAdvance();
            } else {
              cancelAutoAdvance();
            }
          }
        }

        Reveal.on("ready", onRevealEvent);
        Reveal.on("slidechanged", onRevealEvent);
        // In case fragments/auto-animate steps are used inside the slide, also listen for 'fragmentshown' and 'fragmenthidden'
        Reveal.on("fragmentshown", function (e) {
          // if the fragment is part of the CRDT stack step, ensure tails are revealed
          var slide =
            e.fragment && e.fragment.closest
              ? e.fragment.closest("section.present")
              : null;
          if (slide && slide.querySelector(".crdts-words")) {
            revealTailsDelayed();
          }
        });
        Reveal.on("fragmenthidden", function (e) {
          var slide =
            e.fragment && e.fragment.closest
              ? e.fragment.closest("section.present")
              : null;
          if (slide && slide.querySelector(".crdts-words")) {
            // hiding fragments should also hide tails
            if (crdtTimeout) {
              clearTimeout(crdtTimeout);
              crdtTimeout = null;
            }
            hideTails();
          }
        });
      })();
    </script>

    <script src="js/custom/network.js"></script>
    <script src="js/custom/console-sim.js"></script>
    <script src="js/custom/replicas.js"></script>
  </body>
</html>

(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{10061:(e,a,t)=>{Promise.resolve().then(t.bind(t,69377))},33667:(e,a,t)=>{"use strict";t.d(a,{A:()=>n});var i=t(16203),r=t(98915),s=t(56671);let n=()=>({handleSignOut:async()=>{try{let e=(0,i.xI)(r.y);await (0,i.CI)(e),s.oR.success("Signed out successfully")}catch(e){s.oR.error("Error signing out")}}})},44968:(e,a,t)=>{"use strict";t.d(a,{Y:()=>i});let i=[{id:"box_number",accessorKey:"box_number",header:"Box Number",enableSorting:!0},{id:"shelf_code",accessorKey:"shelf_code",header:"Shelf Code",enableSorting:!0},{id:"type",accessorKey:"type",header:"Type",enableSorting:!0},{id:"area_planted",accessorKey:"area_planted",header:"Area Planted",enableSorting:!0},{id:"year",accessorKey:"year",header:"Year(s)",enableSorting:!0},{id:"season",accessorKey:"season",header:"Season",enableSorting:!0},{id:"location",accessorKey:"location",header:"Location",enableSorting:!0},{id:"description",accessorKey:"description",header:"Description",enableSorting:!0},{id:"pedigree",accessorKey:"pedigree",header:"Pedigree",enableSorting:!0},{id:"weight",accessorKey:"weight",header:"Weight (kg)",enableSorting:!0},{id:"remarks",accessorKey:"remarks",header:"Remarks",enableSorting:!0}]},69377:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>k});var i=t(95155),r=t(97168),s=t(19946);let n=(0,s.A)("scan-qr-code",[["path",{d:"M17 12v4a1 1 0 0 1-1 1h-4",key:"uk4fdo"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M17 8V7",key:"q2g9wo"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M7 17h.01",key:"19xn7k"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["rect",{x:"7",y:"7",width:"5",height:"5",rx:"1",key:"m9kyts"}]]);var l=t(98915),o=t(16203),d=t(35695),c=t(56671),h=t(23915),u=t(35317),m=t(68354),p=t(33667),x=t(12115),g=t(31815),b=t(12352),y=t(90578),f=t(44968);let v=(0,s.A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var w=t(66766),j=t(49509);function k(){let e=(0,d.useRouter)(),[a,t]=(0,x.useState)(!1),[s,k]=(0,x.useState)(null),[N,S]=(0,x.useState)(!1),[_,R]=(0,x.useState)(null),{user:C,profile:A,loading:E}=(0,m.J)(),{handleSignOut:M}=(0,p.A)(),P=f.Y.filter(e=>"box_number"!==e.id&&"shelf_code"!==e.id).map(e=>({...e,meta:{...e.meta,editable:"weight"===e.id||"remarks"===e.id}}));j.env.NEXT_PUBLIC_ALLOWED_HOSTS&&j.env.NEXT_PUBLIC_ALLOWED_HOSTS.split(",");let B=async e=>{var a;if(e&&(null==(a=e[0])?void 0:a.rawValue)){let a=e[0].rawValue;R(null),S(!0);try{let e="";if(!(e=a.includes("/box/")?a.split("/box/")[1].split("?")[0].split("#")[0]:a)){R("Invalid QR code format"),S(!1);return}let t=(0,u.P)((0,u.rJ)(l.db,"qrcodes"),(0,u._M)("uuid","==",e)),i=await (0,u.GG)(t);if(i.empty){R("Invalid QR code - box not found"),S(!1);return}let r=i.docs[0].data().box_number,s=(0,u.P)((0,u.rJ)(l.db,"inventory"),(0,u._M)("box_number","==",r)),n=(await (0,u.GG)(s)).docs.map(e=>({...e.data(),id:e.id}));k({boxNumber:r,inventory:n}),c.oR.success("Found ".concat(n.length," items in box ").concat(r))}catch(e){console.error("Error processing QR code:",e),R("Error loading box data"),c.oR.error("Error loading box data")}finally{S(!1)}}};if((0,x.useEffect)(()=>{!E&&C&&(null==A?void 0:A.approved)&&e.push("/dashboard")},[C,A,E,e]),E||C&&(null==A?void 0:A.approved))return(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,i.jsx)(g.y,{className:"h-8 w-8"})});if(C&&A&&!A.approved)return(0,i.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,i.jsxs)("div",{className:"w-full max-w-md p-6 text-center",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Account Pending Approval"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Your account is awaiting admin approval. Please contact an administrator."}),(0,i.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Signed in as: ",C.email]}),(0,i.jsx)(r.$,{onClick:M,variant:"outline",children:"Sign Out"})]})});let L=async()=>{let a=(0,o.xI)(l.y),t=new o.HF;try{let i=(await (0,o.df)(a,t)).user;if(!i.email||!i.email.endsWith("@up.edu.ph")){await a.signOut(),c.oR.error("Only @up.edu.ph email addresses are allowed.");return}let r=(0,u.H9)(l.db,"users",i.uid),s=await (0,u.x7)(r);if(!s.exists()){await (0,u.BN)(r,{email:i.email,displayName:i.displayName,photoURL:i.photoURL,role:"user",approved:!1,createdAt:(0,u.O5)()}),(0,c.oR)("Your account is pending approval by the admin.");return}if(!s.data().approved)return void c.oR.error("Your account is pending admin approval.");c.oR.success("Signed in successfully"),e.push("/dashboard")}catch(a){let e="An unexpected error occurred.";if(a instanceof h.g)switch(a.code){case"auth/popup-closed-by-user":e="Sign-in popup closed before completing sign in.";break;case"auth/cancelled-popup-request":e="Sign-in request was cancelled.";break;case"auth/popup-blocked":e="Sign-in popup was blocked by the browser.";break;case"auth/network-request-failed":e="Network error, please check your connection and try again.";break;case"auth/account-exists-with-different-credential":e="An account already exists with the same email but different sign-in credentials.";break;case"auth/unauthorized-domain":e="The application is not authorized to run on this domain.";break;case"auth/operation-not-allowed":e="Google sign-in is not enabled for this project.";break;default:e=a.message}c.oR.error(e)}};return(0,i.jsx)("main",{className:"flex min-h-svh w-full items-center justify-center p-6 md:p-10",children:s?(0,i.jsxs)("div",{className:"w-full max-w-6xl",children:[(0,i.jsxs)("div",{className:"mb-6 flex items-center gap-4",children:[(0,i.jsxs)(r.$,{variant:"outline",onClick:()=>{t(!1),k(null),R(null),S(!1)},children:[(0,i.jsx)(v,{className:"h-4 w-4 mr-2"}),"Back to Scanner"]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("h1",{className:"text-2xl font-bold",children:["Box ",s.boxNumber," Inventory"]}),(0,i.jsxs)("p",{className:"text-gray-600",children:["Showing all inventory items in box ",s.boxNumber]})]})]}),(0,i.jsx)(y.b,{data:s.inventory,columns:P,loading:N,stickyActions:!0,disableDelete:!0,filterableFields:[{label:"Type",fieldName:"type"},{label:"Area Planted",fieldName:"area_planted"},{label:"Year",fieldName:"year"},{label:"Season",fieldName:"season"},{label:"Location",fieldName:"location"},{label:"Description",fieldName:"description"},{label:"Pedigree",fieldName:"pedigree"},{label:"Weight",fieldName:"weight"}],onRowUpdate:async e=>{if(e&&e.deleted)k(a=>a?{...a,inventory:a.inventory.filter(a=>a.id!==e.id)}:null);else if(e){let a,t;if(s){let i=s.inventory.find(a=>a.id===e.id);a=i?i.weight:void 0,t=i?i.remarks:void 0}k(a=>a?{...a,inventory:a.inventory.map(a=>a.id===e.id?e:a)}:null);try{if(!e.id)throw Error("Document ID is missing.");let i=(0,u.H9)(l.db,"inventory",e.id),r={},s={};if(e.weight!==a&&(r.weight=e.weight,s.weight={from:a,to:e.weight}),e.remarks!==t&&(r.remarks=e.remarks,s.remarks={from:t,to:e.remarks}),Object.keys(r).length>0){await (0,u.mZ)(i,r);let e=(0,u.rJ)(i,"history");await (0,u.BN)((0,u.H9)(e),{creatorId:"anonymous",editedAt:(0,u.O5)(),editedBy:"Anonymous (logged out user)",changes:s})}}catch(e){console.error("Error updating document: ",e),c.oR.error("Failed to update item.")}}}})]}):(0,i.jsx)("div",{className:"w-full max-w-sm grid gap-4 justify-items-center",children:a?(0,i.jsxs)("div",{className:"w-full",children:[(0,i.jsxs)("div",{className:"mb-4 flex items-center gap-4",children:[(0,i.jsxs)(r.$,{variant:"outline",onClick:()=>t(!1),children:[(0,i.jsx)(v,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Scan QR Code"}),(0,i.jsx)("p",{className:"text-sm text-gray-600",children:"Point your camera at a box QR code"})]})]}),_&&(0,i.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,i.jsx)("p",{className:"text-red-600 text-sm",children:_})}),N&&(0,i.jsxs)("div",{className:"mb-4 flex items-center justify-center",children:[(0,i.jsx)(g.y,{className:"h-6 w-6 mr-2"}),(0,i.jsx)("span",{className:"text-sm text-gray-600",children:"Loading box data..."})]}),(0,i.jsx)("div",{className:"w-full max-w-sm mx-auto",children:(0,i.jsx)(b.Lp,{onScan:B,constraints:{width:{ideal:320},height:{ideal:240}},styles:{container:{width:"100%",maxWidth:"320px",height:"auto"},video:{width:"100%",height:"auto"}}})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex flex-col items-center gap-4 mb-2",children:[(0,i.jsxs)("div",{className:"flex items-center gap-8",children:[(0,i.jsx)(w.default,{src:"/up-logo.png",alt:"University of the Philippines Logo",width:130,height:130,priority:!0,className:"object-contain"}),(0,i.jsx)(w.default,{src:"/cropped-IPB-logo.png",alt:"IPB Logo",width:110,height:110,priority:!0,className:"object-contain"})]}),(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-800 text-center",children:"Cereals Inventory"})]}),(0,i.jsxs)(r.$,{variant:"outline",type:"button",onClick:L,children:[(0,i.jsxs)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 48 48",style:{display:"block"},children:[(0,i.jsx)("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),(0,i.jsx)("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),(0,i.jsx)("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),(0,i.jsx)("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"}),(0,i.jsx)("path",{fill:"none",d:"M0 0h48v48H0z"})]}),"Continue with Google"]}),(0,i.jsxs)(r.$,{variant:"outline",type:"button",onClick:()=>t(!0),children:[(0,i.jsx)(n,{}),"Scan QR"]})]})})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[992,163,343,66,352,71,33,678,546,766,408,578,441,684,358],()=>a(10061)),_N_E=e.O()}]);